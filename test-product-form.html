<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Product Addition</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #ff3b3b;
            text-align: center;
            margin-bottom: 30px;
        }
        .form-group {
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #333;
        }
        input, textarea, select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }
        textarea {
            height: 100px;
            resize: vertical;
        }
        .btn {
            background: #ff3b3b;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            width: 100%;
        }
        .btn:hover {
            background: #d32f2f;
        }
        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        .message {
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .loading {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        @media (max-width: 600px) {
            .form-row {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Test Product Addition</h1>
        
        <div id="message"></div>
        
        <form id="productForm">
            <div class="form-row">
                <div class="form-group">
                    <label for="title">Product Title *</label>
                    <input type="text" id="title" name="title" required placeholder="e.g., Premium Cow Feed (20kg)">
                </div>
                <div class="form-group">
                    <label for="brand">Brand</label>
                    <input type="text" id="brand" name="brand" placeholder="e.g., NutriDiet">
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="price">Price (₹) *</label>
                    <input type="number" id="price" name="price" required placeholder="e.g., 850" step="0.01">
                </div>
                <div class="form-group">
                    <label for="stock_quantity">Stock Quantity *</label>
                    <input type="number" id="stock_quantity" name="stock_quantity" required placeholder="e.g., 100">
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="target_animal">Target Animal</label>
                    <input type="text" id="target_animal" name="target_animal" placeholder="e.g., Cow, Buffalo">
                </div>
                <div class="form-group">
                    <label for="net_weight">Net Weight</label>
                    <input type="text" id="net_weight" name="net_weight" placeholder="e.g., 20 kg, 500g">
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="dosage_amount">Dosage Amount</label>
                    <input type="text" id="dosage_amount" name="dosage_amount" placeholder="e.g., 2">
                </div>
                <div class="form-group">
                    <label for="dosage_unit">Dosage Unit</label>
                    <input type="text" id="dosage_unit" name="dosage_unit" placeholder="e.g., kg, ml">
                </div>
            </div>
            
            <div class="form-group">
                <label for="dosage_frequency">Dosage Frequency</label>
                <input type="text" id="dosage_frequency" name="dosage_frequency" placeholder="e.g., Daily, Weekly">
            </div>
            
            <div class="form-group">
                <label for="description">Description</label>
                <textarea id="description" name="description" placeholder="Detailed product description..."></textarea>
            </div>
            
            <div class="form-group">
                <label for="ingredients">Ingredients</label>
                <textarea id="ingredients" name="ingredients" placeholder="List of ingredients..."></textarea>
            </div>
            
            <div class="form-group">
                <label for="status">Status</label>
                <select id="status" name="status">
                    <option value="Available">Available</option>
                    <option value="Out of Stock">Out of Stock</option>
                </select>
            </div>
            
            <button type="submit" class="btn" id="submitBtn">Add Product</button>
        </form>
    </div>

    <script>
        const API_BASE_URL = 'https://api.sociamosaic.com/api';
        
        // Get admin token from localStorage or prompt user
        function getAdminToken() {
            let token = localStorage.getItem('adminToken');
            if (!token) {
                token = prompt('Please enter your admin token:');
                if (token) {
                    localStorage.setItem('adminToken', token);
                }
            }
            return token;
        }
        
        // Show message function
        function showMessage(message, type = 'success') {
            const messageDiv = document.getElementById('message');
            messageDiv.className = `message ${type}`;
            messageDiv.textContent = message;
            messageDiv.style.display = 'block';
            
            if (type === 'success') {
                setTimeout(() => {
                    messageDiv.style.display = 'none';
                }, 5000);
            }
        }
        
        // Create product function
        async function createProduct(productData) {
            const token = getAdminToken();
            if (!token) {
                showMessage('Admin token is required', 'error');
                return { success: false, message: 'No admin token' };
            }
            
            try {
                const response = await fetch(`${API_BASE_URL}/admin/supplements`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(productData)
                });
                
                const result = await response.json();
                return result;
            } catch (error) {
                console.error('Error creating product:', error);
                return { success: false, message: error.message };
            }
        }
        
        // Form submission handler
        document.getElementById('productForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const submitBtn = document.getElementById('submitBtn');
            const originalText = submitBtn.textContent;
            
            // Show loading state
            submitBtn.disabled = true;
            submitBtn.textContent = 'Adding Product...';
            showMessage('Adding product...', 'loading');
            
            // Get form data
            const formData = new FormData(this);
            const productData = {
                title: formData.get('title'),
                brand: formData.get('brand') || null,
                description: formData.get('description') || null,
                target_animal: formData.get('target_animal') || null,
                ingredients: formData.get('ingredients') || null,
                dosage_amount: formData.get('dosage_amount') || null,
                dosage_unit: formData.get('dosage_unit') || null,
                dosage_frequency: formData.get('dosage_frequency') || null,
                net_weight: formData.get('net_weight') || null,
                price: parseFloat(formData.get('price')),
                stock_quantity: parseInt(formData.get('stock_quantity')),
                status: formData.get('status')
            };
            
            try {
                const result = await createProduct(productData);
                
                if (result.success) {
                    showMessage('Product added successfully!', 'success');
                    this.reset(); // Reset form
                } else {
                    showMessage(`Failed to add product: ${result.message}`, 'error');
                }
            } catch (error) {
                showMessage(`Error: ${error.message}`, 'error');
            } finally {
                // Reset button state
                submitBtn.disabled = false;
                submitBtn.textContent = originalText;
            }
        });
        
        // Test with sample data
        function loadSampleData() {
            document.getElementById('title').value = 'प्रीमियम गाय का आहार (20 किलो)';
            document.getElementById('brand').value = 'NutriDiet';
            document.getElementById('price').value = '850';
            document.getElementById('stock_quantity').value = '100';
            document.getElementById('target_animal').value = 'गाय';
            document.getElementById('net_weight').value = '20 किलो';
            document.getElementById('dosage_amount').value = '2';
            document.getElementById('dosage_unit').value = 'किलो';
            document.getElementById('dosage_frequency').value = 'दैनिक';
            document.getElementById('description').value = 'हमारा प्रीमियम गाय का आहार उच्च गुणवत्ता वाले पोषक तत्वों से भरपूर है। यह आहार आपके पशुओं के स्वास्थ्य और दूध उत्पादन को बेहतर बनाने में मदद करता है।';
            document.getElementById('ingredients').value = 'उच्च प्रोटीन सामग्री, विटामिन और खनिज से समृद्ध, प्राकृतिक फाइबर, आवश्यक अमीनो एसिड';
        }
        
        // Add sample data button
        const sampleBtn = document.createElement('button');
        sampleBtn.textContent = 'Load Sample Data';
        sampleBtn.style.cssText = `
            background: #28a745;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin-bottom: 20px;
            width: 100%;
        `;
        sampleBtn.onclick = loadSampleData;
        document.querySelector('.container').insertBefore(sampleBtn, document.getElementById('productForm'));
        
        // Check if backend is running
        async function checkBackend() {
            try {
                const response = await fetch(`${API_BASE_URL.replace('/api', '')}`);
                const result = await response.json();
                console.log('Backend status:', result);
                if (result.status === 'success') {
                    showMessage('✅ Backend connected successfully!', 'success');
                }
            } catch (error) {
                console.error('Backend not reachable:', error);
                showMessage('Warning: Unable to connect to backend at https://api.sociamosaic.com/', 'error');
            }
        }
        
        // Check backend on page load
        checkBackend();
    </script>
</body>
</html> 